{"ast":null,"code":"import { _ as _define_property } from \"@swc/helpers/_/_define_property\";\nimport { _ as _object_spread } from \"@swc/helpers/_/_object_spread\";\nimport { _ as _object_spread_props } from \"@swc/helpers/_/_object_spread_props\";\nimport { _ as _object_without_properties } from \"@swc/helpers/_/_object_without_properties\";\nimport { _ as _sliced_to_array } from \"@swc/helpers/_/_sliced_to_array\";\nimport { _ as _type_of } from \"@swc/helpers/_/_type_of\";\nimport * as React from \"react\";\nimport { classNames } from \"@vkontakte/vkjs\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useExternRef } from \"../../hooks/useExternRef\";\nimport { SizeType } from \"../../lib/adaptivity\";\nimport { defaultFilterFn, getFormFieldModeFromSelectType } from \"../../lib/select\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { debounce, getTitleFromChildren } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport { CustomSelectDropdown } from \"../CustomSelectDropdown/CustomSelectDropdown\";\nimport { CustomSelectOption } from \"../CustomSelectOption/CustomSelectOption\";\nimport { DropdownIcon } from \"../DropdownIcon/DropdownIcon\";\nimport { Input } from \"../Input/Input\";\nimport { SelectMimicry } from \"../SelectMimicry/SelectMimicry\";\nimport { Footnote } from \"../Typography/Footnote/Footnote\";\nimport { CustomSelectClearButton } from \"./CustomSelectClearButton\";\nvar sizeYClassNames = _define_property({\n  none: \"vkuiCustomSelect--sizeY-none\"\n}, SizeType.COMPACT, \"vkuiCustomSelect--sizeY-compact\");\nvar findIndexAfter = function () {\n  var options = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : [],\n    startIndex = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : -1;\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n  return options.findIndex(function (option, i) {\n    return i > startIndex && !option.disabled;\n  });\n};\nvar findIndexBefore = function () {\n  var options = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : [],\n    endIndex = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : options.length;\n  var result = -1;\n  if (endIndex <= 0) {\n    return result;\n  }\n  for (var i = endIndex - 1; i >= 0; i--) {\n    var option = options[i];\n    if (!option.disabled) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n};\nvar warn = warnOnce(\"CustomSelect\");\nvar checkOptionsValueType = function (options) {\n  if (new Set(options.map(function (item) {\n    return _type_of(item.value);\n  })).size > 1) {\n    warn(\"Некоторые значения ваших опций имеют разные типы. onChange всегда возвращает строковый тип.\", \"error\");\n  }\n};\nfunction defaultRenderOptionFn(_param) {\n  var option = _param.option,\n    props = _object_without_properties(_param, [\"option\"]);\n  return /*#__PURE__*/React.createElement(CustomSelectOption, props);\n}\nvar handleOptionDown = function (e) {\n  e.preventDefault();\n};\nfunction findSelectedIndex(options, value, withClear) {\n  if (withClear && value === \"\") {\n    return -1;\n  }\n  var _options_findIndex;\n  return (_options_findIndex = options.findIndex(function (item) {\n    value = typeof item.value === \"number\" ? Number(value) : value;\n    return item.value === value;\n  })) !== null && _options_findIndex !== void 0 ? _options_findIndex : -1;\n}\nvar filter = function (options, inputValue, filterFn) {\n  return typeof filterFn === \"function\" ? options.filter(function (option) {\n    return filterFn(inputValue, option);\n  }) : options;\n};\nvar defaultOptions = [];\n/**\n * @see https://vkcom.github.io/VKUI/#/CustomSelect\n */\nexport function CustomSelect(props) {\n  var _selected;\n  var _React_useState = _sliced_to_array(React.useState(false), 2),\n    opened = _React_useState[0],\n    setOpened = _React_useState[1];\n  var before = props.before,\n    name = props.name,\n    className = props.className,\n    getRef = props.getRef,\n    getRootRef = props.getRootRef,\n    popupDirection = props.popupDirection,\n    style = props.style,\n    onChange = props.onChange,\n    children = props.children,\n    onInputChangeProp = props.onInputChange,\n    renderDropdown = props.renderDropdown,\n    onOpen = props.onOpen,\n    onClose = props.onClose,\n    fetching = props.fetching,\n    forceDropdownPortal = props.forceDropdownPortal,\n    _props_selectType = props.selectType,\n    selectType = _props_selectType === void 0 ? \"default\" : _props_selectType,\n    autoHideScrollbar = props.autoHideScrollbar,\n    autoHideScrollbarDelay = props.autoHideScrollbarDelay,\n    _props_searchable = props.searchable,\n    searchable = _props_searchable === void 0 ? false : _props_searchable,\n    tmp = props.renderOption,\n    renderOptionProp = tmp === void 0 ? defaultRenderOptionFn : tmp,\n    tmp1 = props.options,\n    optionsProp = tmp1 === void 0 ? defaultOptions : tmp1,\n    _props_emptyText = props.emptyText,\n    emptyText = _props_emptyText === void 0 ? \"Ничего не найдено\" : _props_emptyText,\n    _props_filterFn = props.filterFn,\n    filterFn = _props_filterFn === void 0 ? defaultFilterFn : _props_filterFn,\n    iconProp = props.icon,\n    _props_ClearButton = props.ClearButton,\n    ClearButton = _props_ClearButton === void 0 ? CustomSelectClearButton : _props_ClearButton,\n    _props_allowClearButton = props.allowClearButton,\n    allowClearButton = _props_allowClearButton === void 0 ? false : _props_allowClearButton,\n    _props_dropdownOffsetDistance = props.dropdownOffsetDistance,\n    dropdownOffsetDistance = _props_dropdownOffsetDistance === void 0 ? 0 : _props_dropdownOffsetDistance,\n    _props_fixDropdownWidth = props.fixDropdownWidth,\n    fixDropdownWidth = _props_fixDropdownWidth === void 0 ? true : _props_fixDropdownWidth,\n    restProps = _object_without_properties(props, [\"before\", \"name\", \"className\", \"getRef\", \"getRootRef\", \"popupDirection\", \"style\", \"onChange\", \"children\", \"onInputChange\", \"renderDropdown\", \"onOpen\", \"onClose\", \"fetching\", \"forceDropdownPortal\", \"selectType\", \"autoHideScrollbar\", \"autoHideScrollbarDelay\", \"searchable\", \"renderOption\", \"options\", \"emptyText\", \"filterFn\", \"icon\", \"ClearButton\", \"allowClearButton\", \"dropdownOffsetDistance\", \"fixDropdownWidth\"]);\n  if (process.env.NODE_ENV === \"development\") {\n    checkOptionsValueType(optionsProp);\n  }\n  var _useAdaptivity = useAdaptivity(),\n    _useAdaptivity_sizeY = _useAdaptivity.sizeY,\n    sizeY = _useAdaptivity_sizeY === void 0 ? \"none\" : _useAdaptivity_sizeY;\n  var containerRef = React.useRef(null);\n  var handleRootRef = useExternRef(containerRef, getRootRef);\n  var scrollBoxRef = React.useRef(null);\n  var selectElRef = useExternRef(getRef);\n  var _React_useState1 = _sliced_to_array(React.useState(-1), 2),\n    focusedOptionIndex = _React_useState1[0],\n    setFocusedOptionIndex = _React_useState1[1];\n  var _React_useState2 = _sliced_to_array(React.useState(props.value !== undefined), 2),\n    isControlledOutside = _React_useState2[0],\n    setIsControlledOutside = _React_useState2[1];\n  var _React_useState3 = _sliced_to_array(React.useState(\"\"), 2),\n    inputValue = _React_useState3[0],\n    setInputValue = _React_useState3[1];\n  var _props_value, _ref;\n  var _React_useState4 = _sliced_to_array(React.useState(function () {\n      return (_ref = (_props_value = props.value) !== null && _props_value !== void 0 ? _props_value : props.defaultValue) !== null && _ref !== void 0 ? _ref : allowClearButton ? \"\" : undefined;\n    }), 2),\n    nativeSelectValue = _React_useState4[0],\n    setNativeSelectValue = _React_useState4[1];\n  var _React_useState5 = _sliced_to_array(React.useState(\"\"), 2),\n    keyboardInput = _React_useState5[0],\n    setKeyboardInput = _React_useState5[1];\n  var _React_useState6 = _sliced_to_array(React.useState(undefined), 2),\n    popperPlacement = _React_useState6[0],\n    setPopperPlacement = _React_useState6[1];\n  var _React_useState7 = _sliced_to_array(React.useState(optionsProp), 2),\n    options = _React_useState7[0],\n    setOptions = _React_useState7[1];\n  var _props_value1;\n  var _React_useState8 = _sliced_to_array(React.useState(findSelectedIndex(optionsProp, (_props_value1 = props.value) !== null && _props_value1 !== void 0 ? _props_value1 : props.defaultValue, allowClearButton)), 2),\n    selectedOptionIndex = _React_useState8[0],\n    setSelectedOptionIndex = _React_useState8[1];\n  React.useEffect(function () {\n    setIsControlledOutside(props.value !== undefined);\n    var _props_value;\n    setNativeSelectValue(function (nativeSelectValue) {\n      return (_props_value = props.value) !== null && _props_value !== void 0 ? _props_value : nativeSelectValue;\n    });\n  }, [props.value]);\n  useIsomorphicLayoutEffect(function () {\n    if (options.some(function (param) {\n      var value = param.value;\n      return nativeSelectValue === value;\n    }) || allowClearButton && nativeSelectValue === \"\") {\n      var _selectElRef_current;\n      var event = new Event(\"change\", {\n        bubbles: true\n      });\n      (_selectElRef_current = selectElRef.current) === null || _selectElRef_current === void 0 ? void 0 : _selectElRef_current.dispatchEvent(event);\n    }\n  }, [nativeSelectValue]);\n  var selected = React.useMemo(function () {\n    if (!options.length) {\n      return null;\n    }\n    return selectedOptionIndex !== undefined ? options[selectedOptionIndex] : undefined;\n  }, [options, selectedOptionIndex]);\n  var openedClassNames = React.useMemo(function () {\n    var _popperPlacement;\n    return classNames(opened && dropdownOffsetDistance === 0 && (((_popperPlacement = popperPlacement) === null || _popperPlacement === void 0 ? void 0 : _popperPlacement.includes(\"top\")) ? \"vkuiCustomSelect--pop-up\" : \"vkuiCustomSelect--pop-down\"));\n  }, [dropdownOffsetDistance, opened, popperPlacement]);\n  var resetKeyboardInput = React.useCallback(function () {\n    setKeyboardInput(\"\");\n  }, []);\n  var scrollToElement = React.useCallback(function (index) {\n    var center = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : false;\n    var dropdown = scrollBoxRef.current;\n    var item = dropdown ? dropdown.children[index] : null;\n    if (!item || !dropdown) {\n      return;\n    }\n    var dropdownHeight = dropdown.offsetHeight;\n    var scrollTop = dropdown.scrollTop;\n    var itemTop = item.offsetTop;\n    var itemHeight = item.offsetHeight;\n    if (center) {\n      dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n      dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n    } else if (itemTop < scrollTop) {\n      dropdown.scrollTop = itemTop;\n    }\n  }, []);\n  var isValidIndex = React.useCallback(function (index) {\n    var _options_length;\n    return index >= 0 && index < ((_options_length = options.length) !== null && _options_length !== void 0 ? _options_length : 0);\n  }, [options.length]);\n  var focusOptionByIndex = React.useCallback(function (index) {\n    var scrollTo = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : true;\n    var _option;\n    var _options_length;\n    if (index === undefined || index < 0 || index > ((_options_length = options.length) !== null && _options_length !== void 0 ? _options_length : 0) - 1) {\n      return;\n    }\n    var option = options[index];\n    if ((_option = option) === null || _option === void 0 ? void 0 : _option.disabled) {\n      return;\n    }\n    if (scrollTo) {\n      scrollToElement(index);\n    }\n    // Это оптимизация, прежде всего, под `onMouseOver`\n    setFocusedOptionIndex(function (focusedOptionIndex) {\n      return focusedOptionIndex !== index ? index : focusedOptionIndex;\n    });\n  }, [options, scrollToElement]);\n  var areOptionsShown = React.useCallback(function () {\n    return scrollBoxRef.current !== null;\n  }, []);\n  var setScrollBoxRef = React.useCallback(function (ref) {\n    scrollBoxRef.current = ref;\n    if (ref && selectedOptionIndex !== undefined && isValidIndex(selectedOptionIndex)) {\n      {\n        scrollToElement(selectedOptionIndex, true);\n      }\n    }\n  }, [isValidIndex, scrollToElement, selectedOptionIndex]);\n  var onKeyboardInput = React.useCallback(function (key) {\n    var fullInput = keyboardInput + key;\n    var optionIndex = options.findIndex(function (option) {\n      return getTitleFromChildren(option.label).toLowerCase().includes(fullInput);\n    });\n    if (optionIndex !== undefined && optionIndex > -1) {\n      focusOptionByIndex(optionIndex);\n    }\n    setKeyboardInput(fullInput);\n  }, [focusOptionByIndex, keyboardInput, options]);\n  /**\n  * Note: сбрасывать `options` через `setOptions(optionsProp)` не нужно.\n  *  Сброс происходит в одном из эффекте `updateOptionsAndSelectedOptionIndex()`.\n  */\n  var close = React.useCallback(function () {\n    var _onClose;\n    resetKeyboardInput();\n    setInputValue(\"\");\n    setOpened(false);\n    setFocusedOptionIndex(-1);\n    (_onClose = onClose) === null || _onClose === void 0 ? void 0 : _onClose();\n  }, [onClose, resetKeyboardInput]);\n  var selectOption = React.useCallback(function (index) {\n    var _item, _item1;\n    var item = options[index];\n    setNativeSelectValue((_item = item) === null || _item === void 0 ? void 0 : _item.value);\n    close();\n    var shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync = isControlledOutside && props.value !== nativeSelectValue && nativeSelectValue === ((_item1 = item) === null || _item1 === void 0 ? void 0 : _item1.value);\n    if (shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync) {\n      var _selectElRef_current;\n      var event = new Event(\"change\", {\n        bubbles: true\n      });\n      (_selectElRef_current = selectElRef.current) === null || _selectElRef_current === void 0 ? void 0 : _selectElRef_current.dispatchEvent(event);\n    }\n  }, [close, options, selectElRef, isControlledOutside, props.value, nativeSelectValue]);\n  var selectFocused = React.useCallback(function () {\n    if (focusedOptionIndex === undefined || !isValidIndex(focusedOptionIndex)) {\n      return;\n    }\n    selectOption(focusedOptionIndex);\n  }, [focusedOptionIndex, isValidIndex, selectOption]);\n  var open = React.useCallback(function () {\n    setOpened(true);\n    setFocusedOptionIndex(selectedOptionIndex);\n    if (typeof onOpen === \"function\") {\n      onOpen();\n    }\n  }, [onOpen, selectedOptionIndex]);\n  var onBlur = React.useCallback(function () {\n    var _selectElRef_current;\n    close();\n    var event = new Event(\"blur\");\n    (_selectElRef_current = selectElRef.current) === null || _selectElRef_current === void 0 ? void 0 : _selectElRef_current.dispatchEvent(event);\n  }, [close, selectElRef]);\n  var resetFocusedOption = React.useCallback(function () {\n    setFocusedOptionIndex(-1);\n  }, []);\n  var onFocus = React.useCallback(function () {\n    var _selectElRef_current;\n    var event = new Event(\"focus\");\n    (_selectElRef_current = selectElRef.current) === null || _selectElRef_current === void 0 ? void 0 : _selectElRef_current.dispatchEvent(event);\n  }, [selectElRef]);\n  var onClick = React.useCallback(function () {\n    if (opened) {\n      close();\n    } else {\n      open();\n    }\n  }, [close, open, opened]);\n  var handleKeyUp = React.useMemo(function () {\n    return debounce(resetKeyboardInput, 1000);\n  }, [resetKeyboardInput]);\n  var focusOption = React.useCallback(function (type) {\n    var index = focusedOptionIndex;\n    if (type === \"next\") {\n      var nextIndex = findIndexAfter(options, index);\n      index = nextIndex === -1 ? findIndexAfter(options) : nextIndex; // Следующий за index или первый валидный до index\n    } else if (type === \"prev\") {\n      var beforeIndex = findIndexBefore(options, index);\n      index = beforeIndex === -1 ? findIndexBefore(options) : beforeIndex; // Предшествующий index или последний валидный после index\n    }\n\n    focusOptionByIndex(index);\n  }, [focusOptionByIndex, focusedOptionIndex, options]);\n  React.useEffect(function updateOptionsAndSelectedOptionIndex() {\n    var _props_value, _ref;\n    var value = (_ref = (_props_value = props.value) !== null && _props_value !== void 0 ? _props_value : nativeSelectValue) !== null && _ref !== void 0 ? _ref : props.defaultValue;\n    var options = searchable && inputValue !== undefined ? filter(optionsProp, inputValue, filterFn) : optionsProp;\n    setOptions(options);\n    setSelectedOptionIndex(findSelectedIndex(options, value, allowClearButton));\n  }, [filterFn, inputValue, nativeSelectValue, optionsProp, props.defaultValue, props.value, searchable, allowClearButton]);\n  /**\n  * Нужен для правильного поведения обработчика onClick на select. Фильтрует клики, которые были сделаны по\n  * выпадающему списку.\n  */\n  var onLabelClick = React.useCallback(function (e) {\n    var _scrollBoxRef_current;\n    if ((_scrollBoxRef_current = scrollBoxRef.current) === null || _scrollBoxRef_current === void 0 ? void 0 : _scrollBoxRef_current.contains(e.target)) {\n      e.preventDefault();\n    }\n  }, []);\n  var onNativeSelectChange = function (e) {\n    var newSelectedOptionIndex = findSelectedIndex(options, e.currentTarget.value, allowClearButton);\n    if (selectedOptionIndex !== newSelectedOptionIndex) {\n      var _onChange;\n      if (!isControlledOutside) {\n        setSelectedOptionIndex(newSelectedOptionIndex);\n      }\n      (_onChange = onChange) === null || _onChange === void 0 ? void 0 : _onChange(e);\n    }\n  };\n  var onInputKeyDown = React.useCallback(function (event) {\n    [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) && areOptionsShown() && event.preventDefault();\n    switch (event.key) {\n      case \"ArrowUp\":\n        areOptionsShown() && focusOption(\"prev\");\n        break;\n      case \"ArrowDown\":\n        areOptionsShown() && focusOption(\"next\");\n        break;\n      case \"Escape\":\n        close();\n        break;\n      case \"Enter\":\n        areOptionsShown() && selectFocused();\n        break;\n    }\n  }, [areOptionsShown, close, focusOption, selectFocused]);\n  var onInputChange = React.useCallback(function (e) {\n    // TODO [>=6]: удалить `onInputChangeProp`.\n    if (onInputChangeProp) {\n      var options = onInputChangeProp(e, optionsProp);\n      if (options) {\n        if (process.env.NODE_ENV === \"development\") {\n          warn(\"Этот метод фильтрации устарел. Возвращаемое значение onInputChange будет \" + \"проигнорировано в v6.0.0. Для фильтрации обновляйте props.options самостоятельно или используйте свойство filterFn.\");\n        }\n        setOptions(options);\n        setSelectedOptionIndex(findSelectedIndex(options, nativeSelectValue, allowClearButton));\n      }\n    } else {\n      var options1 = filter(optionsProp, e.target.value, filterFn);\n      setOptions(options1);\n      setSelectedOptionIndex(findSelectedIndex(options1, nativeSelectValue, allowClearButton));\n    }\n    setInputValue(e.target.value);\n  }, [filterFn, nativeSelectValue, onInputChangeProp, optionsProp, allowClearButton]);\n  var handleKeyDownSelect = React.useCallback(function (event) {\n    if (event.key.length === 1 && event.key !== \" \") {\n      onKeyboardInput(event.key);\n      return;\n    }\n    [\"ArrowUp\", \"ArrowDown\", \"Escape\", \"Enter\"].includes(event.key) && areOptionsShown() && event.preventDefault();\n    switch (event.key) {\n      case \"ArrowUp\":\n        if (opened) {\n          areOptionsShown() && focusOption(\"prev\");\n        } else {\n          open();\n        }\n        break;\n      case \"ArrowDown\":\n        if (opened) {\n          areOptionsShown() && focusOption(\"next\");\n        } else {\n          open();\n        }\n        break;\n      case \"Escape\":\n        close();\n        break;\n      case \"Enter\":\n      case \"Spacebar\":\n      case \" \":\n        if (opened) {\n          areOptionsShown() && selectFocused();\n        } else {\n          open();\n        }\n        break;\n    }\n  }, [areOptionsShown, close, focusOption, onKeyboardInput, open, opened, selectFocused]);\n  var handleOptionClick = React.useCallback(function (e) {\n    var _e_currentTarget_parentNode;\n    var index = Array.prototype.indexOf.call((_e_currentTarget_parentNode = e.currentTarget.parentNode) === null || _e_currentTarget_parentNode === void 0 ? void 0 : _e_currentTarget_parentNode.children, e.currentTarget);\n    var option = options[index];\n    if (option && !option.disabled) {\n      selectOption(index);\n    }\n  }, [options, selectOption]);\n  var handleOptionHover = React.useCallback(function (e) {\n    var _e_currentTarget_parentNode;\n    focusOptionByIndex(Array.prototype.indexOf.call((_e_currentTarget_parentNode = e.currentTarget.parentNode) === null || _e_currentTarget_parentNode === void 0 ? void 0 : _e_currentTarget_parentNode.children, e.currentTarget), false);\n  }, [focusOptionByIndex]);\n  var renderOption = React.useCallback(function (option, index) {\n    var hovered = index === focusedOptionIndex;\n    var selected = index === selectedOptionIndex;\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      key: \"\".concat(option.value)\n    }, renderOptionProp({\n      option: option,\n      hovered: hovered,\n      children: option.label,\n      selected: selected,\n      disabled: option.disabled,\n      onClick: handleOptionClick,\n      onMouseDown: handleOptionDown,\n      // Используем `onMouseOver` вместо `onMouseEnter`.\n      // При параметре `searchable`, обновляется \"ребёнок\", из-за чего `onMouseEnter` не срабатывает в следующих кейсах:\n      //  1. До загрузки выпадающего списка, курсор мышки находится над произвольным элементом этого списка.\n      //     > Лечение: только увод курсора мыши и возвращении его обратно вызывает событие `onMouseEnter` на этот элемент.\n      //  2. Если это тач-устройство.\n      //     > Лечение: нужно нажать на какой-нибудь произвольный элемент списка, после чего `onMouseEnter` будет работать на соседние элементы,\n      //     но не на тот, на который нажали в первый раз.\n      // Более подробно по ссылке https://github.com/facebook/react/issues/13956#issuecomment-1082055744\n      onMouseOver: handleOptionHover\n    }));\n  }, [focusedOptionIndex, handleOptionClick, handleOptionHover, renderOptionProp, selectedOptionIndex]);\n  var resolvedContent = React.useMemo(function () {\n    var _options;\n    var defaultDropdownContent = ((_options = options) === null || _options === void 0 ? void 0 : _options.length) > 0 ? options.map(renderOption) : /*#__PURE__*/React.createElement(Footnote, {\n      className: \"vkuiCustomSelect__empty\"\n    }, emptyText);\n    if (typeof renderDropdown === \"function\") {\n      return renderDropdown({\n        defaultDropdownContent: defaultDropdownContent\n      });\n    } else {\n      return defaultDropdownContent;\n    }\n  }, [emptyText, options, renderDropdown, renderOption]);\n  var controlledValueSet = isControlledOutside && props.value !== \"\";\n  var uncontrolledValueSet = !isControlledOutside && nativeSelectValue !== \"\";\n  var clearButtonShown = allowClearButton && !opened && (controlledValueSet || uncontrolledValueSet);\n  var clearButton = React.useMemo(function () {\n    if (!clearButtonShown) {\n      return null;\n    }\n    return /*#__PURE__*/React.createElement(ClearButton, {\n      className: iconProp === undefined ? \"vkuiCustomSelect--clear-icon\" : undefined,\n      onClick: function () {\n        return setNativeSelectValue(\"\");\n      }\n    });\n  }, [clearButtonShown, ClearButton, iconProp]);\n  var icon = React.useMemo(function () {\n    if (iconProp !== undefined) {\n      return iconProp;\n    }\n    return /*#__PURE__*/React.createElement(DropdownIcon, {\n      className: clearButtonShown ? \"vkuiCustomSelect__dropdown-icon\" : undefined,\n      opened: opened\n    });\n  }, [clearButtonShown, iconProp, opened]);\n  var afterIcons = (icon || clearButtonShown) && /*#__PURE__*/React.createElement(React.Fragment, null, clearButton, icon);\n  return /*#__PURE__*/React.createElement(\"label\", {\n    className: classNames(\"vkuiCustomSelect\", sizeY !== SizeType.REGULAR && sizeYClassNames[sizeY], className),\n    style: style,\n    ref: handleRootRef,\n    onClick: onLabelClick\n  }, opened && searchable ? /*#__PURE__*/React.createElement(Input, _object_spread_props(_object_spread({}, restProps), {\n    autoFocus: true,\n    onBlur: onBlur,\n    className: openedClassNames,\n    value: inputValue,\n    onKeyDown: onInputKeyDown,\n    onChange: onInputChange,\n    // TODO Ожидается, что клик поймает нативный select, но его перехватывает Input. К сожалению, это приводит к конфликтам типизации.\n    // TODO Нужно перестать пытаться превратить CustomSelect в select. Тогда эта проблема уйдёт.\n    // @ts-expect-error: TS2322 MouseEventHandler<HTMLSelectElement> !== MouseEventHandler<HTMLInputElement>\n    onClick: props.onClick,\n    before: before,\n    after: afterIcons,\n    mode: getFormFieldModeFromSelectType(selectType)\n  })) : /*#__PURE__*/React.createElement(SelectMimicry, _object_spread_props(_object_spread({}, restProps), {\n    \"aria-hidden\": true,\n    onClick: onClick,\n    onKeyDown: handleKeyDownSelect,\n    onKeyUp: handleKeyUp,\n    onFocus: onFocus,\n    onBlur: onBlur,\n    className: openedClassNames,\n    before: before,\n    after: afterIcons,\n    selectType: selectType\n  }), (_selected = selected) === null || _selected === void 0 ? void 0 : _selected.label), /*#__PURE__*/React.createElement(\"select\", {\n    ref: selectElRef,\n    name: name,\n    onChange: onNativeSelectChange,\n    onBlur: props.onBlur,\n    onFocus: props.onFocus,\n    onClick: props.onClick,\n    value: nativeSelectValue,\n    \"aria-hidden\": true,\n    className: \"vkuiCustomSelect__control\"\n  }, allowClearButton && /*#__PURE__*/React.createElement(\"option\", {\n    key: \"\",\n    value: \"\"\n  }), optionsProp.map(function (item) {\n    return /*#__PURE__*/React.createElement(\"option\", {\n      key: \"\".concat(item.value),\n      value: item.value\n    });\n  })), opened && /*#__PURE__*/React.createElement(CustomSelectDropdown, {\n    targetRef: containerRef,\n    placement: popupDirection,\n    scrollBoxRef: setScrollBoxRef,\n    onPlacementChange: setPopperPlacement,\n    onMouseLeave: resetFocusedOption,\n    fetching: fetching,\n    offsetDistance: dropdownOffsetDistance,\n    sameWidth: fixDropdownWidth,\n    forcePortal: forceDropdownPortal,\n    autoHideScrollbar: autoHideScrollbar,\n    autoHideScrollbarDelay: autoHideScrollbarDelay\n  }, resolvedContent));\n}","map":{"version":3,"names":["React","classNames","useAdaptivity","useExternRef","SizeType","defaultFilterFn","getFormFieldModeFromSelectType","useIsomorphicLayoutEffect","debounce","getTitleFromChildren","warnOnce","CustomSelectDropdown","CustomSelectOption","DropdownIcon","Input","SelectMimicry","Footnote","CustomSelectClearButton","sizeYClassNames","_define_property","none","COMPACT","findIndexAfter","options","arguments","length","startIndex","findIndex","option","i","disabled","findIndexBefore","endIndex","result","warn","checkOptionsValueType","Set","map","item","_type_of","value","size","defaultRenderOptionFn","_param","props","_object_without_properties","createElement","handleOptionDown","e","preventDefault","findSelectedIndex","withClear","_options_findIndex","Number","filter","inputValue","filterFn","defaultOptions","CustomSelect","_selected","_React_useState","_sliced_to_array","useState","opened","setOpened","before","name","className","getRef","getRootRef","popupDirection","style","onChange","children","onInputChangeProp","onInputChange","renderDropdown","onOpen","onClose","fetching","forceDropdownPortal","_props_selectType","selectType","autoHideScrollbar","autoHideScrollbarDelay","_props_searchable","searchable","tmp","renderOption","renderOptionProp","tmp1","optionsProp","_props_emptyText","emptyText","_props_filterFn","iconProp","icon","_props_ClearButton","ClearButton","_props_allowClearButton","allowClearButton","_props_dropdownOffsetDistance","dropdownOffsetDistance","_props_fixDropdownWidth","fixDropdownWidth","restProps","process","env","NODE_ENV","_useAdaptivity","_useAdaptivity_sizeY","sizeY","containerRef","useRef","handleRootRef","scrollBoxRef","selectElRef","_React_useState1","focusedOptionIndex","setFocusedOptionIndex","_React_useState2","undefined","isControlledOutside","setIsControlledOutside","_React_useState3","setInputValue","_props_value","_ref","_React_useState4","defaultValue","nativeSelectValue","setNativeSelectValue","_React_useState5","keyboardInput","setKeyboardInput","_React_useState6","popperPlacement","setPopperPlacement","_React_useState7","setOptions","_props_value1","_React_useState8","selectedOptionIndex","setSelectedOptionIndex","useEffect","some","param","_selectElRef_current","event","Event","bubbles","current","dispatchEvent","selected","useMemo","openedClassNames","_popperPlacement","includes","resetKeyboardInput","useCallback","scrollToElement","index","center","dropdown","dropdownHeight","offsetHeight","scrollTop","itemTop","offsetTop","itemHeight","isValidIndex","_options_length","focusOptionByIndex","scrollTo","_option","areOptionsShown","setScrollBoxRef","ref","onKeyboardInput","key","fullInput","optionIndex","label","toLowerCase","close","_onClose","selectOption","_item","_item1","shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync","selectFocused","open","onBlur","resetFocusedOption","onFocus","onClick","handleKeyUp","focusOption","type","nextIndex","beforeIndex","updateOptionsAndSelectedOptionIndex","onLabelClick","_scrollBoxRef_current","contains","target","onNativeSelectChange","newSelectedOptionIndex","currentTarget","_onChange","onInputKeyDown","options1","handleKeyDownSelect","handleOptionClick","_e_currentTarget_parentNode","Array","prototype","indexOf","call","parentNode","handleOptionHover","hovered","Fragment","concat","onMouseDown","onMouseOver","resolvedContent","_options","defaultDropdownContent","controlledValueSet","uncontrolledValueSet","clearButtonShown","clearButton","afterIcons","REGULAR","_object_spread_props","_object_spread","autoFocus","onKeyDown","after","mode","onKeyUp","targetRef","placement","onPlacementChange","onMouseLeave","offsetDistance","sameWidth","forcePortal"],"sources":["/Users/evgeny/Desktop/VsCodeProjects/vk-client/vk-client/node_modules/@vkontakte/vkui/src/components/CustomSelect/CustomSelect.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { SizeType } from '../../lib/adaptivity';\nimport type { PlacementWithAuto } from '../../lib/floating';\nimport { defaultFilterFn, getFormFieldModeFromSelectType } from '../../lib/select';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { debounce, getTitleFromChildren } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { TrackerOptionsProps } from '../CustomScrollView/useTrackerVisibility';\nimport { CustomSelectDropdown } from '../CustomSelectDropdown/CustomSelectDropdown';\nimport {\n  CustomSelectOption,\n  CustomSelectOptionProps,\n} from '../CustomSelectOption/CustomSelectOption';\nimport { DropdownIcon } from '../DropdownIcon/DropdownIcon';\nimport { FormFieldProps } from '../FormField/FormField';\nimport { Input } from '../Input/Input';\nimport { NativeSelectProps } from '../NativeSelect/NativeSelect';\nimport { SelectType } from '../Select/Select';\nimport { SelectMimicry } from '../SelectMimicry/SelectMimicry';\nimport { Footnote } from '../Typography/Footnote/Footnote';\nimport { CustomSelectClearButton, CustomSelectClearButtonProps } from './CustomSelectClearButton';\nimport styles from './CustomSelect.module.css';\n\nconst sizeYClassNames = {\n  none: styles['CustomSelect--sizeY-none'],\n  [SizeType.COMPACT]: styles['CustomSelect--sizeY-compact'],\n};\n\nconst findIndexAfter = (options: CustomSelectOptionInterface[] = [], startIndex = -1) => {\n  if (startIndex >= options.length - 1) {\n    return -1;\n  }\n  return options.findIndex((option, i) => i > startIndex && !option.disabled);\n};\n\nconst findIndexBefore = (\n  options: CustomSelectOptionInterface[] = [],\n  endIndex: number = options.length,\n) => {\n  let result = -1;\n  if (endIndex <= 0) {\n    return result;\n  }\n  for (let i = endIndex - 1; i >= 0; i--) {\n    let option = options[i];\n\n    if (!option.disabled) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n};\n\nconst warn = warnOnce('CustomSelect');\n\nconst checkOptionsValueType = (options: CustomSelectOptionInterface[]) => {\n  if (new Set(options.map((item) => typeof item.value)).size > 1) {\n    warn(\n      'Некоторые значения ваших опций имеют разные типы. onChange всегда возвращает строковый тип.',\n      'error',\n    );\n  }\n};\n\nfunction defaultRenderOptionFn({ option, ...props }: CustomSelectOptionProps): React.ReactNode {\n  return <CustomSelectOption {...props} />;\n}\n\nconst handleOptionDown: MouseEventHandler = (e: React.MouseEvent<HTMLElement>) => {\n  e.preventDefault();\n};\n\nfunction findSelectedIndex(\n  options: CustomSelectOptionInterface[],\n  value: SelectValue,\n  withClear: boolean,\n) {\n  if (withClear && value === '') {\n    return -1;\n  }\n  return (\n    options.findIndex((item) => {\n      value = typeof item.value === 'number' ? Number(value) : value;\n      return item.value === value;\n    }) ?? -1\n  );\n}\n\nconst filter = (\n  options: SelectProps['options'],\n  inputValue: string,\n  filterFn: SelectProps['filterFn'],\n) => {\n  return typeof filterFn === 'function'\n    ? options.filter((option) => filterFn(inputValue, option))\n    : options;\n};\n\nconst defaultOptions: CustomSelectOptionInterface[] = [];\n\ntype SelectValue = React.SelectHTMLAttributes<HTMLSelectElement>['value'];\n\nexport interface CustomSelectOptionInterface {\n  value: SelectValue;\n  label: React.ReactElement | string;\n  disabled?: boolean;\n  [index: string]: any;\n}\n\nexport interface SelectProps extends NativeSelectProps, FormFieldProps, TrackerOptionsProps {\n  /**\n   * Если `true`, то при клике на селект в нём появится текстовое поле для поиска по `options`. По умолчанию поиск\n   * производится по `option.label`.\n   */\n  searchable?: boolean;\n  /**\n   * Текст, который будет отображен, если приходит пустой `options`.\n   */\n  emptyText?: string;\n  /**\n   * > ⚠️ В v6 из возвращаемых типов будет удалён `CustomSelectOptionInterface[]`. Для кастомной фильтрации используйте\n   * > `filterFn`.\n   */\n  onInputChange?: (\n    e: React.ChangeEvent,\n    options: CustomSelectOptionInterface[],\n  ) => void | CustomSelectOptionInterface[];\n  options: CustomSelectOptionInterface[];\n  /**\n   * Функция для кастомной фильтрации. По умолчанию поиск производится по `option.label`.\n   */\n  filterFn?:\n    | false\n    | ((\n        value: string,\n        option: CustomSelectOptionInterface,\n        getOptionLabel?: (option: Partial<CustomSelectOptionInterface>) => string,\n      ) => boolean);\n  popupDirection?: 'top' | 'bottom';\n  /**\n   * Рендер-проп для кастомного рендера опции.\n   * В объекте аргумента приходят [свойства опции](https://vkcom.github.io/VKUI/#/CustomSelectOption?id=props)\n   *\n   * > ⚠️  Важно: cвойство опции `disabled` должно выставляться только через проп `options`.\n   * > Запрещается выставлять `disabled` проп опциям в обход `options`, иначе селект не будет знать об актуальном состоянии\n   * опции.\n   */\n  renderOption?: (props: CustomSelectOptionProps) => React.ReactNode;\n  /**\n   * Рендер-проп для кастомного рендера содержимого дропдауна.\n   * В `defaultDropdownContent` содержится список опций в виде скроллящегося блока.\n   */\n  renderDropdown?: ({\n    defaultDropdownContent,\n  }: {\n    defaultDropdownContent: React.ReactNode;\n  }) => React.ReactNode;\n  /**\n   * Если `true`, то в дропдауне вместо списка опций рисуется спиннер. При переданных `renderDropdown` и `fetching: true`\n   * \"победит\" `renderDropdown`.\n   */\n  fetching?: boolean;\n  onClose?: VoidFunction;\n  onOpen?: VoidFunction;\n  /**\n   * Иконка раскрывающегося списка\n   */\n  icon?: React.ReactNode;\n  /**\n   * Кастомная кнопка для очистки значения.\n   * Должна принимать обязательное свойство `onClick`\n   */\n  ClearButton?: React.ComponentType<CustomSelectClearButtonProps>;\n  /**\n   * Если `true`, то справа будет отображаться кнопка для очистки значения\n   */\n  allowClearButton?: boolean;\n  dropdownOffsetDistance?: number;\n  fixDropdownWidth?: boolean;\n  forceDropdownPortal?: boolean;\n  selectType?: SelectType;\n}\n\ntype MouseEventHandler = (event: React.MouseEvent<HTMLElement>) => void;\n\n/**\n * @see https://vkcom.github.io/VKUI/#/CustomSelect\n */\nexport function CustomSelect(props: SelectProps) {\n  const [opened, setOpened] = React.useState(false);\n  const {\n    before,\n    name,\n    className,\n    getRef,\n    getRootRef,\n    popupDirection,\n    style,\n    onChange,\n    children,\n    onInputChange: onInputChangeProp,\n    renderDropdown,\n    onOpen,\n    onClose,\n    fetching,\n    forceDropdownPortal,\n    selectType = 'default',\n    autoHideScrollbar,\n    autoHideScrollbarDelay,\n    searchable = false,\n    renderOption: renderOptionProp = defaultRenderOptionFn,\n    options: optionsProp = defaultOptions,\n    emptyText = 'Ничего не найдено',\n    filterFn = defaultFilterFn,\n    icon: iconProp,\n    ClearButton = CustomSelectClearButton,\n    allowClearButton = false,\n    dropdownOffsetDistance = 0,\n    fixDropdownWidth = true,\n    ...restProps\n  } = props;\n\n  if (process.env.NODE_ENV === 'development') {\n    checkOptionsValueType(optionsProp);\n  }\n\n  const { sizeY = 'none' } = useAdaptivity();\n\n  const containerRef = React.useRef<HTMLLabelElement>(null);\n  const handleRootRef = useExternRef(containerRef, getRootRef);\n  const scrollBoxRef = React.useRef<HTMLDivElement | null>(null);\n  const selectElRef = useExternRef(getRef);\n\n  const [focusedOptionIndex, setFocusedOptionIndex] = React.useState<number | undefined>(-1);\n  const [isControlledOutside, setIsControlledOutside] = React.useState(props.value !== undefined);\n  const [inputValue, setInputValue] = React.useState('');\n  const [nativeSelectValue, setNativeSelectValue] = React.useState(\n    () => props.value ?? props.defaultValue ?? (allowClearButton ? '' : undefined),\n  );\n  const [keyboardInput, setKeyboardInput] = React.useState('');\n  const [popperPlacement, setPopperPlacement] = React.useState<PlacementWithAuto | undefined>(\n    undefined,\n  );\n  const [options, setOptions] = React.useState(optionsProp);\n  const [selectedOptionIndex, setSelectedOptionIndex] = React.useState<number | undefined>(\n    findSelectedIndex(optionsProp, props.value ?? props.defaultValue, allowClearButton),\n  );\n\n  React.useEffect(() => {\n    setIsControlledOutside(props.value !== undefined);\n    setNativeSelectValue((nativeSelectValue) => props.value ?? nativeSelectValue);\n  }, [props.value]);\n\n  useIsomorphicLayoutEffect(() => {\n    if (\n      options.some(({ value }) => nativeSelectValue === value) ||\n      (allowClearButton && nativeSelectValue === '')\n    ) {\n      const event = new Event('change', { bubbles: true });\n\n      selectElRef.current?.dispatchEvent(event);\n    }\n  }, [nativeSelectValue]);\n\n  const selected = React.useMemo(() => {\n    if (!options.length) {\n      return null;\n    }\n\n    return selectedOptionIndex !== undefined ? options[selectedOptionIndex] : undefined;\n  }, [options, selectedOptionIndex]);\n\n  const openedClassNames = React.useMemo(\n    () =>\n      classNames(\n        opened &&\n          dropdownOffsetDistance === 0 &&\n          (popperPlacement?.includes('top')\n            ? styles['CustomSelect--pop-up']\n            : styles['CustomSelect--pop-down']),\n      ),\n    [dropdownOffsetDistance, opened, popperPlacement],\n  );\n\n  const resetKeyboardInput = React.useCallback(() => {\n    setKeyboardInput('');\n  }, []);\n\n  const scrollToElement = React.useCallback((index: number, center = false) => {\n    const dropdown = scrollBoxRef.current;\n    const item = dropdown ? (dropdown.children[index] as HTMLElement) : null;\n\n    if (!item || !dropdown) {\n      return;\n    }\n\n    const dropdownHeight = dropdown.offsetHeight;\n    const scrollTop = dropdown.scrollTop;\n    const itemTop = item.offsetTop;\n    const itemHeight = item.offsetHeight;\n\n    if (center) {\n      dropdown.scrollTop = itemTop - dropdownHeight / 2 + itemHeight / 2;\n    } else if (itemTop + itemHeight > dropdownHeight + scrollTop) {\n      dropdown.scrollTop = itemTop - dropdownHeight + itemHeight;\n    } else if (itemTop < scrollTop) {\n      dropdown.scrollTop = itemTop;\n    }\n  }, []);\n\n  const isValidIndex = React.useCallback(\n    (index: number) => {\n      return index >= 0 && index < (options.length ?? 0);\n    },\n    [options.length],\n  );\n\n  const focusOptionByIndex = React.useCallback(\n    (index: number | undefined, scrollTo = true) => {\n      if (index === undefined || index < 0 || index > (options.length ?? 0) - 1) {\n        return;\n      }\n\n      const option = options[index];\n\n      if (option?.disabled) {\n        return;\n      }\n\n      if (scrollTo) {\n        scrollToElement(index);\n      }\n\n      // Это оптимизация, прежде всего, под `onMouseOver`\n      setFocusedOptionIndex((focusedOptionIndex) =>\n        focusedOptionIndex !== index ? index : focusedOptionIndex,\n      );\n    },\n    [options, scrollToElement],\n  );\n\n  const areOptionsShown = React.useCallback(() => {\n    return scrollBoxRef.current !== null;\n  }, []);\n\n  const setScrollBoxRef = React.useCallback(\n    (ref: HTMLDivElement | null) => {\n      scrollBoxRef.current = ref;\n\n      if (ref && selectedOptionIndex !== undefined && isValidIndex(selectedOptionIndex)) {\n        {\n          scrollToElement(selectedOptionIndex, true);\n        }\n      }\n    },\n    [isValidIndex, scrollToElement, selectedOptionIndex],\n  );\n\n  const onKeyboardInput = React.useCallback(\n    (key: string) => {\n      const fullInput = keyboardInput + key;\n\n      const optionIndex = options.findIndex((option) => {\n        return getTitleFromChildren(option.label).toLowerCase().includes(fullInput);\n      });\n\n      if (optionIndex !== undefined && optionIndex > -1) {\n        focusOptionByIndex(optionIndex);\n      }\n\n      setKeyboardInput(fullInput);\n    },\n    [focusOptionByIndex, keyboardInput, options],\n  );\n\n  /**\n   * Note: сбрасывать `options` через `setOptions(optionsProp)` не нужно.\n   *  Сброс происходит в одном из эффекте `updateOptionsAndSelectedOptionIndex()`.\n   */\n  const close = React.useCallback(() => {\n    resetKeyboardInput();\n\n    setInputValue('');\n    setOpened(false);\n    setFocusedOptionIndex(-1);\n    onClose?.();\n  }, [onClose, resetKeyboardInput]);\n\n  const selectOption = React.useCallback(\n    (index: number) => {\n      const item = options[index];\n\n      setNativeSelectValue(item?.value);\n      close();\n\n      const shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync =\n        isControlledOutside &&\n        props.value !== nativeSelectValue &&\n        nativeSelectValue === item?.value;\n\n      if (shouldTriggerOnChangeWhenControlledAndInnerValueIsOutOfSync) {\n        const event = new Event('change', { bubbles: true });\n        selectElRef.current?.dispatchEvent(event);\n      }\n    },\n    [close, options, selectElRef, isControlledOutside, props.value, nativeSelectValue],\n  );\n\n  const selectFocused = React.useCallback(() => {\n    if (focusedOptionIndex === undefined || !isValidIndex(focusedOptionIndex)) {\n      return;\n    }\n\n    selectOption(focusedOptionIndex);\n  }, [focusedOptionIndex, isValidIndex, selectOption]);\n\n  const open = React.useCallback(() => {\n    setOpened(true);\n    setFocusedOptionIndex(selectedOptionIndex);\n\n    if (typeof onOpen === 'function') {\n      onOpen();\n    }\n  }, [onOpen, selectedOptionIndex]);\n\n  const onBlur = React.useCallback(() => {\n    close();\n    const event = new Event('blur');\n    selectElRef.current?.dispatchEvent(event);\n  }, [close, selectElRef]);\n\n  const resetFocusedOption = React.useCallback(() => {\n    setFocusedOptionIndex(-1);\n  }, []);\n\n  const onFocus = React.useCallback(() => {\n    const event = new Event('focus');\n    selectElRef.current?.dispatchEvent(event);\n  }, [selectElRef]);\n\n  const onClick = React.useCallback(() => {\n    if (opened) {\n      close();\n    } else {\n      open();\n    }\n  }, [close, open, opened]);\n\n  const handleKeyUp = React.useMemo(() => debounce(resetKeyboardInput, 1000), [resetKeyboardInput]);\n\n  const focusOption = React.useCallback(\n    (type: 'next' | 'prev') => {\n      let index = focusedOptionIndex;\n\n      if (type === 'next') {\n        const nextIndex = findIndexAfter(options, index);\n        index = nextIndex === -1 ? findIndexAfter(options) : nextIndex; // Следующий за index или первый валидный до index\n      } else if (type === 'prev') {\n        const beforeIndex = findIndexBefore(options, index);\n        index = beforeIndex === -1 ? findIndexBefore(options) : beforeIndex; // Предшествующий index или последний валидный после index\n      }\n\n      focusOptionByIndex(index);\n    },\n    [focusOptionByIndex, focusedOptionIndex, options],\n  );\n\n  React.useEffect(\n    function updateOptionsAndSelectedOptionIndex() {\n      const value = props.value ?? nativeSelectValue ?? props.defaultValue;\n\n      const options =\n        searchable && inputValue !== undefined\n          ? filter(optionsProp, inputValue, filterFn)\n          : optionsProp;\n\n      setOptions(options);\n      setSelectedOptionIndex(findSelectedIndex(options, value, allowClearButton));\n    },\n    [\n      filterFn,\n      inputValue,\n      nativeSelectValue,\n      optionsProp,\n      props.defaultValue,\n      props.value,\n      searchable,\n      allowClearButton,\n    ],\n  );\n\n  /**\n   * Нужен для правильного поведения обработчика onClick на select. Фильтрует клики, которые были сделаны по\n   * выпадающему списку.\n   */\n  const onLabelClick = React.useCallback((e: React.MouseEvent<HTMLLabelElement>) => {\n    if (scrollBoxRef.current?.contains(e.target as Node)) {\n      e.preventDefault();\n    }\n  }, []);\n\n  const onNativeSelectChange: React.ChangeEventHandler<HTMLSelectElement> = (e) => {\n    const newSelectedOptionIndex = findSelectedIndex(\n      options,\n      e.currentTarget.value,\n      allowClearButton,\n    );\n\n    if (selectedOptionIndex !== newSelectedOptionIndex) {\n      if (!isControlledOutside) {\n        setSelectedOptionIndex(newSelectedOptionIndex);\n      }\n      onChange?.(e);\n    }\n  };\n\n  const onInputKeyDown: React.KeyboardEventHandler<HTMLInputElement> = React.useCallback(\n    (event) => {\n      ['ArrowUp', 'ArrowDown', 'Escape', 'Enter'].includes(event.key) &&\n        areOptionsShown() &&\n        event.preventDefault();\n\n      switch (event.key) {\n        case 'ArrowUp':\n          areOptionsShown() && focusOption('prev');\n          break;\n        case 'ArrowDown':\n          areOptionsShown() && focusOption('next');\n          break;\n        case 'Escape':\n          close();\n          break;\n        case 'Enter':\n          areOptionsShown() && selectFocused();\n          break;\n      }\n    },\n    [areOptionsShown, close, focusOption, selectFocused],\n  );\n\n  const onInputChange: React.ChangeEventHandler<HTMLInputElement> = React.useCallback(\n    (e) => {\n      // TODO [>=6]: удалить `onInputChangeProp`.\n      if (onInputChangeProp) {\n        const options = onInputChangeProp(e, optionsProp);\n        if (options) {\n          if (process.env.NODE_ENV === 'development') {\n            warn(\n              'Этот метод фильтрации устарел. Возвращаемое значение onInputChange будет ' +\n                'проигнорировано в v6.0.0. Для фильтрации обновляйте props.options самостоятельно или используйте свойство filterFn.',\n            );\n          }\n          setOptions(options);\n          setSelectedOptionIndex(findSelectedIndex(options, nativeSelectValue, allowClearButton));\n        }\n      } else {\n        const options = filter(optionsProp, e.target.value, filterFn);\n        setOptions(options);\n        setSelectedOptionIndex(findSelectedIndex(options, nativeSelectValue, allowClearButton));\n      }\n      setInputValue(e.target.value);\n    },\n    [filterFn, nativeSelectValue, onInputChangeProp, optionsProp, allowClearButton],\n  );\n\n  const handleKeyDownSelect = React.useCallback(\n    (event: React.KeyboardEvent) => {\n      if (event.key.length === 1 && event.key !== ' ') {\n        onKeyboardInput(event.key);\n        return;\n      }\n\n      ['ArrowUp', 'ArrowDown', 'Escape', 'Enter'].includes(event.key) &&\n        areOptionsShown() &&\n        event.preventDefault();\n\n      switch (event.key) {\n        case 'ArrowUp':\n          if (opened) {\n            areOptionsShown() && focusOption('prev');\n          } else {\n            open();\n          }\n          break;\n        case 'ArrowDown':\n          if (opened) {\n            areOptionsShown() && focusOption('next');\n          } else {\n            open();\n          }\n          break;\n        case 'Escape':\n          close();\n          break;\n        case 'Enter':\n        case 'Spacebar':\n        case ' ':\n          if (opened) {\n            areOptionsShown() && selectFocused();\n          } else {\n            open();\n          }\n          break;\n      }\n    },\n    [areOptionsShown, close, focusOption, onKeyboardInput, open, opened, selectFocused],\n  );\n\n  const handleOptionClick = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      const index = Array.prototype.indexOf.call(\n        e.currentTarget.parentNode?.children,\n        e.currentTarget,\n      );\n      const option = options[index];\n\n      if (option && !option.disabled) {\n        selectOption(index);\n      }\n    },\n    [options, selectOption],\n  );\n\n  const handleOptionHover = React.useCallback(\n    (e: React.MouseEvent<HTMLElement>) => {\n      focusOptionByIndex(\n        Array.prototype.indexOf.call(e.currentTarget.parentNode?.children, e.currentTarget),\n        false,\n      );\n    },\n    [focusOptionByIndex],\n  );\n\n  const renderOption = React.useCallback(\n    (option: CustomSelectOptionInterface, index: number) => {\n      const hovered = index === focusedOptionIndex;\n      const selected = index === selectedOptionIndex;\n\n      return (\n        <React.Fragment key={`${option.value}`}>\n          {renderOptionProp({\n            option,\n            hovered,\n            children: option.label,\n            selected,\n            disabled: option.disabled,\n            onClick: handleOptionClick,\n            onMouseDown: handleOptionDown,\n            // Используем `onMouseOver` вместо `onMouseEnter`.\n            // При параметре `searchable`, обновляется \"ребёнок\", из-за чего `onMouseEnter` не срабатывает в следующих кейсах:\n            //  1. До загрузки выпадающего списка, курсор мышки находится над произвольным элементом этого списка.\n            //     > Лечение: только увод курсора мыши и возвращении его обратно вызывает событие `onMouseEnter` на этот элемент.\n            //  2. Если это тач-устройство.\n            //     > Лечение: нужно нажать на какой-нибудь произвольный элемент списка, после чего `onMouseEnter` будет работать на соседние элементы,\n            //     но не на тот, на который нажали в первый раз.\n            // Более подробно по ссылке https://github.com/facebook/react/issues/13956#issuecomment-1082055744\n            onMouseOver: handleOptionHover,\n          })}\n        </React.Fragment>\n      );\n    },\n    [\n      focusedOptionIndex,\n      handleOptionClick,\n      handleOptionHover,\n      renderOptionProp,\n      selectedOptionIndex,\n    ],\n  );\n\n  const resolvedContent = React.useMemo(() => {\n    const defaultDropdownContent =\n      options?.length > 0 ? (\n        options.map(renderOption)\n      ) : (\n        <Footnote className={styles['CustomSelect__empty']}>{emptyText}</Footnote>\n      );\n\n    if (typeof renderDropdown === 'function') {\n      return renderDropdown({ defaultDropdownContent });\n    } else {\n      return defaultDropdownContent;\n    }\n  }, [emptyText, options, renderDropdown, renderOption]);\n\n  const controlledValueSet = isControlledOutside && props.value !== '';\n  const uncontrolledValueSet = !isControlledOutside && nativeSelectValue !== '';\n  const clearButtonShown =\n    allowClearButton && !opened && (controlledValueSet || uncontrolledValueSet);\n\n  const clearButton = React.useMemo(() => {\n    if (!clearButtonShown) {\n      return null;\n    }\n\n    return (\n      <ClearButton\n        className={iconProp === undefined ? styles['CustomSelect--clear-icon'] : undefined}\n        onClick={() => setNativeSelectValue('')}\n      />\n    );\n  }, [clearButtonShown, ClearButton, iconProp]);\n\n  const icon = React.useMemo(() => {\n    if (iconProp !== undefined) {\n      return iconProp;\n    }\n\n    return (\n      <DropdownIcon\n        className={clearButtonShown ? styles['CustomSelect__dropdown-icon'] : undefined}\n        opened={opened}\n      />\n    );\n  }, [clearButtonShown, iconProp, opened]);\n\n  const afterIcons = (icon || clearButtonShown) && (\n    <React.Fragment>\n      {clearButton}\n      {icon}\n    </React.Fragment>\n  );\n\n  return (\n    <label\n      className={classNames(\n        styles['CustomSelect'],\n        sizeY !== SizeType.REGULAR && sizeYClassNames[sizeY],\n        className,\n      )}\n      style={style}\n      ref={handleRootRef}\n      onClick={onLabelClick}\n    >\n      {opened && searchable ? (\n        <Input\n          {...restProps}\n          autoFocus\n          onBlur={onBlur}\n          className={openedClassNames}\n          value={inputValue}\n          onKeyDown={onInputKeyDown}\n          onChange={onInputChange}\n          // TODO Ожидается, что клик поймает нативный select, но его перехватывает Input. К сожалению, это приводит к конфликтам типизации.\n          // TODO Нужно перестать пытаться превратить CustomSelect в select. Тогда эта проблема уйдёт.\n          // @ts-expect-error: TS2322 MouseEventHandler<HTMLSelectElement> !== MouseEventHandler<HTMLInputElement>\n          onClick={props.onClick}\n          before={before}\n          after={afterIcons}\n          mode={getFormFieldModeFromSelectType(selectType)}\n        />\n      ) : (\n        <SelectMimicry\n          {...restProps}\n          aria-hidden\n          onClick={onClick}\n          onKeyDown={handleKeyDownSelect}\n          onKeyUp={handleKeyUp}\n          onFocus={onFocus}\n          onBlur={onBlur}\n          className={openedClassNames}\n          before={before}\n          after={afterIcons}\n          selectType={selectType}\n        >\n          {selected?.label}\n        </SelectMimicry>\n      )}\n      <select\n        ref={selectElRef}\n        name={name}\n        onChange={onNativeSelectChange}\n        onBlur={props.onBlur}\n        onFocus={props.onFocus}\n        onClick={props.onClick}\n        value={nativeSelectValue}\n        aria-hidden\n        className={styles['CustomSelect__control']}\n      >\n        {allowClearButton && <option key=\"\" value=\"\" />}\n        {optionsProp.map((item) => (\n          <option key={`${item.value}`} value={item.value} />\n        ))}\n      </select>\n      {opened && (\n        <CustomSelectDropdown\n          targetRef={containerRef}\n          placement={popupDirection}\n          scrollBoxRef={setScrollBoxRef}\n          onPlacementChange={setPopperPlacement}\n          onMouseLeave={resetFocusedOption}\n          fetching={fetching}\n          offsetDistance={dropdownOffsetDistance}\n          sameWidth={fixDropdownWidth}\n          forcePortal={forceDropdownPortal}\n          autoHideScrollbar={autoHideScrollbar}\n          autoHideScrollbarDelay={autoHideScrollbarDelay}\n        >\n          {resolvedContent}\n        </CustomSelectDropdown>\n      )}\n    </label>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}